name: Main workflow
on: [push]
jobs:
  run:
    name: Run
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:
        operating-system: [windows-2019, windows-2022]
    steps:
      - name: Test
        run: |
          $currentDirectory = (Get-Location).Path
          Set-Location "C:\Program Files (x86)\Microsoft Visual Studio\Installer\"         
          $componentsToRemove= @(
            "Microsoft.VisualStudio.Component.VC.v141.x86.x64"
          )
          [string]$workloadArgs = $componentsToRemove | ForEach-Object {" --add " +  $_}
          $Arguments = ('/c', "vs_installer.exe", 'modify', '--installPath', "`"$InstallPath`"",$workloadArgs, '--quiet', '--norestart', '--nocache')        # should be run twice
          $process = Start-Process -FilePath cmd.exe -ArgumentList $Arguments -Wait -PassThru -WindowStyle Hidden
          Set-Location $currentDirectory
      - name: Test
        run: |
          $MSVCDirectory = vswhere -latest -find "VC\Tools\MSVC"
          Get-ChildItem $MSVCDirectory
