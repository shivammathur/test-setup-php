name: 'Test Formulae'
on: ['push']
jobs:
  run:    
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:      
        runs: [1,1,1,1,1]
        operating-system: [macos-14, macos-13, macos-12]
    name: Test
    steps:
    - uses: Homebrew/actions/setup-homebrew@master
    - run: |
        set -x
        brew test-bot --only-cleanup-before
        brew test-bot --only-setup
        export HOMEBREW_CHANGE_ARCH_TO_ARM=1
        export HOMEBREW_DEVELOPER=1
        export HOMEBREW_NO_AUTO_UPDATE=1
        export HOMEBREW_NO_ENV_HINTS=1
        export HOMEBREW_NO_INSTALL_CLEANUP=1
        export HOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK=1
        brew install --force --overwrite \
          pkg-config \
          autoconf \
          bison \
          re2c
        brew install --force --overwrite \
          openssl@1.1 \
          curl \
          krb5 \
          bzip2 \
          enchant \
          libffi \
          libpng \
          webp \
          freetype \
          intltool \
          icu4c \
          libiconv \
          zlib \
          t1lib \
          gd \
          libzip \
          gmp \
          tidy-html5 \
          libxml2 \
          libjpeg \
          libsodium \
          libxslt \
          postgresql
        brew link icu4c gettext --force --overwrite
