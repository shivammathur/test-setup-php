name: Runner Workflow
on:
  push:
jobs:
  runner:
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:
        operating-system: [ubuntu-20.04, ubuntu-22.04, ubuntu-24.04]
        php: ['8.1', '8.2', '8.3']
        swoole: [5.1.6, 6.0.0]
        include:
          - operating-system: ubuntu-20.04
            php: '8.4'
            swoole: 6.0.0
          - operating-system: ubuntu-22.04
            php: '8.4'
            swoole: 6.0.0
          - operating-system: ubuntu-24.04
            php: '8.4'
            swoole: 6.0.0
        
    steps:

      - name: Install PHP
        uses: shivammathur/setup-php@verbose
        with:
          php-version: ${{ matrix.php }}
          extensions: swoole-${{ matrix.swoole }}
        env:
          SWOOLE_LIBS: libbrotli-dev
          SWOOLE_CONFIGURE_ARGS: --with-brotli-dir=/usr

      - name: Testing PHP version
        run: |
          php -r "echo phpversion('swoole') . PHP_EOL;"          
          php -v && php -m
          php -r "if(phpversion('swoole') != '${{ matrix.swoole }}') { throw new Exception('Wrong swoole version'); }"
