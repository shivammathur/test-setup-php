name: 'Test Formulae'
on: [push]
jobs:
  tests:
    strategy:
      matrix:
        php: ['5.3', '5.4', '5.5', '5.6', '7.0', '7.1', '7.2', '7.3', '7.4', '8.0', '8.1', '8.2', '8.3']
        os: [ubuntu-22.04, ubuntu-20.04, ubuntu-18.04]
    runs-on: ${{ matrix.os }}
    steps:    
      - run: |
          version=8.1
          sudo apt-get purge php-* php* -y
          sudo rm -rf /etc/apt/sources.list.d/*ondrej*
          sudo apt-get update
          sudo apt-get install -y --no-install-recommends \
              php$version \
              php$version-amqp \
              php$version-apcu \
              php$version-bcmath \
              php$version-bz2 \
              php$version-cgi \
              php$version-cli \
              php$version-common \
              php$version-curl \
              php$version-dba \
              php$version-dev \
              php$version-enchant \
              php$version-fpm \
              php$version-gd \
              php$version-gmp \
              php$version-igbinary \
              php$version-imagick \
              php$version-imap \
              php$version-interbase \
              php$version-intl \
              php$version-ldap \
              php$version-mbstring \
              php$version-memcache \
              php$version-memcached \
              php$version-mongodb \
              php$version-mysql \
              php$version-odbc \
              php$version-opcache \
              php$version-pgsql \
              php$version-phpdbg \
              php$version-pspell \
              php$version-readline \
              php$version-redis \
              php$version-snmp \
              php$version-soap \
              php$version-sqlite3 \
              php$version-sybase \
              php$version-tidy \
              php$version-xdebug \
              php$version-xml \
              php$version-xsl \
              php$version-yaml \
              php$version-zip \
              php$version-zmq
      - run: php -v
      - uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php }}
      - run: |
          php -v
          php -r "if(strpos(phpversion(), '${{ matrix.php }}') === false && '${{ matrix.php }}' != 'latest') {throw new Exception('Wrong PHP version Installed');}"
