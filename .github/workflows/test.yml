name: 'Intl workflow'
on:
  push:
jobs:
  intl:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-24.04-arm, ubuntu-24.04, ubuntu-22.04]
        icu: [50.2, 73.2]
        ts: [ts, nts]
    steps:
      - name: Setup PHP 8.3
        uses: shivammathur/setup-php@develop
        with:
          php-version: 8.3
          extensions: intl-${{ matrix.icu }}
        env:
          phpts: ${{ matrix.ts }}
      - name: Setup PHP 8.4
        uses: shivammathur/setup-php@develop
        with:
          php-version: 8.4
          extensions: intl-${{ matrix.icu }}
        env:
          phpts: ${{ matrix.ts }}
      - name: Setup PHP 8.5
        uses: shivammathur/setup-php@develop
        with:
          php-version: 8.5
          extensions: intl-${{ matrix.icu }}
        env:
          phpts: ${{ matrix.ts }}
      - name: Testing ICU version
        run: |
          for v in 8.3 8.4 8.5; do
            icu_version=$(php$v -i | grep "ICU version =>" | sed -e "s|.*=> s*||")
            echo php$v: $icu_version
            [ "$icu_version" != "${{ matrix.icu }}" ] && 	echo "::warning::failed to setup ${{ matrix.icu }} on php $v"
            php$v -v
          done
