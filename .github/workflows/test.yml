name: 'Test Formulae'
on: ['push']
jobs:
  run:    
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:
        runs: [1,1,1,1,1,1,1]
        operating-system: [macos-14, macos-13, macos-12]
    name: Test
    steps:
    
    - run: |
        set -x
        formula_installer="$(brew --repo)"/Library/Homebrew/formula_installer.rb
        code=" keg.link\(verbose: verbose\?"
        sudo sed -Ei '' "s/$code.*/$code, overwrite: true\)/" "$formula_installer"
        brew install --force --overwrite \
          pkg-config \
          autoconf \
          bison \
          re2c
        brew install --force --overwrite \
          openssl@1.1 \
          curl \
          krb5 \
          bzip2 \
          enchant \
          libffi \
          libpng \
          webp \
          freetype \
          intltool \
          icu4c \
          libiconv \
          zlib \
          t1lib \
          gd \
          libzip \
          gmp \
          tidy-html5 \
          libxml2 \
          libjpeg \
          libsodium \
          libxslt \
          postgresql
        brew link icu4c gettext --force --overwrite
