name: Main workflow
on: [push]
jobs:
  run:
    name: Run
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [windows-2022]
    steps:
      - uses: mxschmitt/action-tmate@v3.18
      - name: Install
        run: |
          $component = "Microsoft.VisualStudio.Component.VC.140"
          Write-Host "Adding:" $component
          $vsYear = "${{ matrix.os }}".split('-')[1]
          if($vsYear -eq '2019') {
            $iPath = "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise"
          } else {
            $iPath = "C:\Program Files\Microsoft Visual Studio\2022\Enterprise"
          }
  
          Start-Process -FilePath "C:\Program Files (x86)\Microsoft Visual Studio\Installer\vs_installer.exe" -ArgumentList "modify","--add",$component,"--installPath",$iPath,"--passive","--includeRecommended","--norestart","--noUpdateInstaller" -Wait
  
          Start-Process -FilePath "C:\Program Files (x86)\Microsoft Visual Studio\Installer\vs_installer.exe" -ArgumentList "export","--config","info-post.txt","--installPath",$iPath,"--passive","--noUpdateInstaller" -Wait
      - name: Test
        run: |
          $MSVCDirectory = vswhere -latest -find "VC\Tools\MSVC"
          Get-ChildItem $MSVCDirectory
          
