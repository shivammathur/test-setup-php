name: Runner
on:
  push:
jobs:  
    get-extension-matrix:
        runs-on: ubuntu-latest
        name: "Windows Build Matrix"
        outputs:
            matrix: ${{ steps.extension-matrix.outputs.matrix }}
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: Get The Extension Matrix
              id: extension-matrix
              uses: php/php-windows-builder/extension-matrix@v1
              with:
                php-version-list: '8.0, 8.1, 8.2, 8.3, 8.4, 8.5'
                arch-list: 'x64'

    windows:
        needs: get-extension-matrix
        runs-on: ${{ matrix.os }}
        name: "Windows"
        strategy:
            matrix: ${{fromJson(needs.get-extension-matrix.outputs.matrix)}}
        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                repository: derickr/xdebug
                ref: php85-sapi-header
            - name: Build The Extension
              uses: php/php-windows-builder/extension@master
              with:
                php-version: ${{ matrix.php-version }}
                arch: ${{ matrix.arch }}
                ts: ${{ matrix.ts }}
                args: --with-xdebug
                test-runner: run-xdebug-tests.php
                libs: zlib
