name: OpenSSL Windows Workflow
on:
  push:
jobs:
  run:
    runs-on: ${{ matrix.operating-system }}
    strategy:
      fail-fast: false
      matrix:
        operating-system: [windows-latest]
        php: [5.5, 5.6, 7.2, 7.4, 8.1, 8.2, 8.3, 8.4, 8.5]
    steps:
      - name: Setup PHP
        uses: shivammathur/setup-php@develop
        with:
          php-version: ${{ matrix.php }}

      - name: Check PHP
        run: |
          php -v
          php -m     

      - name: Check OpenSSL config
        run: |
          php -i | findstr openssl
          Get-Content $env:OPENSSL_CONF

      - name: Test
        shell: php {0}
        run: |
          <?php
          error_reporting(E_ALL);
          $config = array(
             "digest_alg" => "sha256",
             "private_key_bits" => 2048,
             "private_key_type" => OPENSSL_KEYTYPE_RSA,
          );
          $res = openssl_pkey_new($config);
          openssl_pkey_export($res, $privatekey);
          var_dump($privatekey);
